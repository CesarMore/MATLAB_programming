syms Ixx Iyy Izz sP cP sT cT sS cS tauPhi tauTheta tauPsi Pp Tp Sp sx4 cx4 sx5 cx5 sx6 cx6 x10 x11 x12



J = [Ixx,                0,                           -(Ixx)*sT;
    0,         Iyy*(cP)^2 + Izz*(sP)^2 , cP*cT*sP*(Iyy-Izz);
  -(Ixx)*sT  cP*cT*sP*(Iyy-Izz)  (Ixx)*(sT)^2 + (Iyy)*(cT)^2 *(sP)^2 + (Izz)*(cP)^2*(cT)^2 ]



Jinv = inv(J)
pretty(Jinv)


tau = [tauPhi;
       tauTheta;
       tauPsi]

   
MatrCori = [0,  (Iyy-Izz)*(Tp*cP*sP+Pp*sP^2*cT)+(Izz-Iyy)*Pp*cP^2*cT-Ixx*Pp*cT, (Izz-Iyy)*Pp*cP*sP*cT^2;
       (Izz-Iyy)*(Tp*cP*sP+Sp*sP*cT)+(Iyy-Izz)*Pp*cP^2*cT+Ixx*Pp*cT, (Izz-Iyy)*Pp*cP*sP, -Ixx*Pp*sT*cT+Iyy*Pp*sP^2*sT*cT+Izz*Pp*cP^2*sT*cT;
       (Iyy-Izz)*Pp*cT^2*sP*cP-Ixx*Tp*cT, (Izz-Iyy)*(Tp*cP*sP*sT+Pp*sP^2*cT)+(Iyy-Izz)*Pp*cP^2*cT+Ixx*Pp*sT*cT-Iyy*Pp*sP^2*sT*cT-Izz*Pp*cP^2*sT*cT, (Iyy-Izz)*Pp*cP*sP*cT^2-Iyy*Tp*sP^2*cT*sT-Izz*Tp*cP^2*cT*sT+Ixx*Tp*cT*sT];
   
etap = [Pp; Tp; Sp]


eta2p = Jinv*(tau - MatrCori*etap)

%---------------------------------------------------------------------------------------

eta2pE = subs(eta2p,[sP cP sT cT sS cS Pp Tp Sp], [sx4 cx4 sx5 cx5 sx6 cx6 x10 x11 x12])
%

% 
phi2pVE = ((tauPhi + x11*(Ixx*cx5*x10 - (cx5*x10*sx4^2 + cx4*x11*sx4)*(Iyy - Izz) + cx4^2*cx5*x10*(Iyy - Izz)) + cx4*cx5^2*sx4*x10*x12*(Iyy - Izz))*(Iyy*Izz*cx4^4*cx5^2 ... 
    + 2*Iyy*Izz*cx4^2*cx5^2*sx4^2 + Ixx*Iyy*cx4^2*sx5^2 + Iyy*Izz*cx5^2*sx4^4 + Ixx*Izz*sx4^2*sx5^2))/(Ixx*Iyy*Izz*cx4^4*cx5^2 + 2*Ixx*Iyy*Izz*cx4^2*cx5^2*sx4^2 + Ixx*Iyy*Izz*cx5^2*sx4^4) ...
    + (sx5*(Iyy*cx4^2 + Izz*sx4^2)*(tauPsi + x11*((Iyy - Izz)*(cx5*x10*sx4^2 + cx4*sx5*x11*sx4) - cx4^2*cx5*x10*(Iyy - Izz) - Ixx*cx5*sx5*x10 + Izz*cx4^2*cx5*sx5*x10 + Iyy*cx5*sx4^2*sx5*x10) ...
    - x12*(- Izz*sx5*x11*cx4^2*cx5 + x10*(Iyy - Izz)*cx4*cx5^2*sx4 - Iyy*sx5*x11*cx5*sx4^2 + Ixx*sx5*x11*cx5) + x10*(- cx4*sx4*x10*(Iyy - Izz)*cx5^2 + Ixx*x11*cx5)))/(Iyy*Izz*cx4^4*cx5^2 + 2*Iyy*Izz*cx4^2*cx5^2*sx4^2 ...
    + Iyy*Izz*cx5^2*sx4^4) - (cx4*sx4*sx5*(Iyy - Izz)*(tauTheta - x10*(Ixx*cx5*x10 - (Iyy - Izz)*(cx4*sx4*x11 + cx5*sx4*x12) + cx4^2*cx5*x10*(Iyy - Izz)) - x12*(Izz*cx5*sx5*x10*cx4^2 + Iyy*cx5*sx5*x10*sx4^2 - Ixx*cx5*sx5*x10) ...
    + cx4*sx4*x10*x11*(Iyy - Izz)))/(Iyy*Izz*cx5*cx4^4 + 2*Iyy*Izz*cx5*cx4^2*sx4^2 + Iyy*Izz*cx5*sx4^4)
%
theta2pVE = ((Izz*cx4^2 + Iyy*sx4^2)*(tauTheta - x10*(Ixx*cx5*x10 - (Iyy - Izz)*(cx4*sx4*x11 + cx5*sx4*x12) + cx4^2*cx5*x10*(Iyy - Izz)) - x12*(Izz*cx5*sx5*x10*cx4^2 + Iyy*cx5*sx5*x10*sx4^2 ...
    - Ixx*cx5*sx5*x10) + cx4*sx4*x10*x11*(Iyy - Izz)))/(Iyy*Izz*cx4^4 + 2*Iyy*Izz*cx4^2*sx4^2 + Iyy*Izz*sx4^4) - (cx4*sx4*(Iyy - Izz)*(tauPsi + x11*((Iyy - Izz)*(cx5*x10*sx4^2 + cx4*sx5*x11*sx4) - cx4^2*cx5*x10*(Iyy - Izz) ...
    - Ixx*cx5*sx5*x10 + Izz*cx4^2*cx5*sx5*x10 + Iyy*cx5*sx4^2*sx5*x10) - x12*(- Izz*sx5*x11*cx4^2*cx5 + x10*(Iyy - Izz)*cx4*cx5^2*sx4 - Iyy*sx5*x11*cx5*sx4^2 + Ixx*sx5*x11*cx5) ...
    + x10*(- cx4*sx4*x10*(Iyy - Izz)*cx5^2 + Ixx*x11*cx5)))/(Iyy*Izz*cx5*cx4^4 + 2*Iyy*Izz*cx5*cx4^2*sx4^2 + Iyy*Izz*cx5*sx4^4) - (cx4*sx4*sx5*(Iyy - Izz)*(tauPhi + x11*(Ixx*cx5*x10 - (cx5*x10*sx4^2 + cx4*x11*sx4)*(Iyy - Izz) ...
    + cx4^2*cx5*x10*(Iyy - Izz)) + cx4*cx5^2*sx4*x10*x12*(Iyy - Izz)))/(Iyy*Izz*cx5*cx4^4 + 2*Iyy*Izz*cx5*cx4^2*sx4^2 + Iyy*Izz*cx5*sx4^4)
% 
psi2pVE = ((Iyy*cx4^2 + Izz*sx4^2)*(tauPsi + x11*((Iyy - Izz)*(cx5*x10*sx4^2 + cx4*sx5*x11*sx4) - cx4^2*cx5*x10*(Iyy - Izz) - Ixx*cx5*sx5*x10 + Izz*cx4^2*cx5*sx5*x10 + Iyy*cx5*sx4^2*sx5*x10) ...
    - x12*(- Izz*sx5*x11*cx4^2*cx5 + x10*(Iyy - Izz)*cx4*cx5^2*sx4 - Iyy*sx5*x11*cx5*sx4^2 + Ixx*sx5*x11*cx5) + x10*(- cx4*sx4*x10*(Iyy - Izz)*cx5^2 + Ixx*x11*cx5)))/(Iyy*Izz*cx4^4*cx5^2 + 2*Iyy*Izz*cx4^2*cx5^2*sx4^2 ...
    + Iyy*Izz*cx5^2*sx4^4) + (sx5*(Iyy*cx4^2 + Izz*sx4^2)*(tauPhi + x11*(Ixx*cx5*x10 - (cx5*x10*sx4^2 + cx4*x11*sx4)*(Iyy - Izz) + cx4^2*cx5*x10*(Iyy - Izz)) + cx4*cx5^2*sx4*x10*x12*(Iyy - Izz)))/(Iyy*Izz*cx4^4*cx5^2 ...
    + 2*Iyy*Izz*cx4^2*cx5^2*sx4^2 + Iyy*Izz*cx5^2*sx4^4) - (cx4*sx4*(Iyy - Izz)*(tauTheta - x10*(Ixx*cx5*x10 - (Iyy - Izz)*(cx4*sx4*x11 + cx5*sx4*x12) + cx4^2*cx5*x10*(Iyy - Izz)) - x12*(Izz*cx5*sx5*x10*cx4^2 + Iyy*cx5*sx5*x10*sx4^2 ...
    - Ixx*cx5*sx5*x10) + cx4*sx4*x10*x11*(Iyy - Izz)))/(Iyy*Izz*cx5*cx4^4 + 2*Iyy*Izz*cx5*cx4^2*sx4^2 + Iyy*Izz*cx5*sx4^4)
%%
dxdt(4,1) = x(10);
dxdt(5,1) = x(11);
dxdt(6,1) = x(12);
dxdt(7,1) = (1/m)*f*(cos(x(4)).*sin(x(4)).*cos(x(6)) + sin(x(4)).*sin(x(6)));
dxdt(8,1) = (1/m)*f*(cos(x(4)).*sin(x(5)).*sin(x(6)) - sin(x(4)).*cos(x(6)));
dxdt(9,1) = (1/m)*f*(cos(x(4)).*sin(x(5)) - g);





dxdt(7,1) = (1/m)*f*(cos(x(4)).*sin(x(4)).*cos(x(6)) + sin(x(4)).*sin(x(6)));
dxdt(8,1) = (1/m)*f*(cos(x(4)).*sin(x(5)).*sin(x(6)) - sin(x(4)).*cos(x(6)));
dxdt(9,1) = (1/m)*f*(cos(x(4)).*sin(x(5)) - g);
dxdt(10,1) = ((TauPhi + x(11)*(Ixx*cos(x(5))*x(10) - (cos(x(5))*x(10)*(sin(x(4)))^2 + cos(x(4))*x(11)*sin(x(4))*(Iyy - Izz)...
    + (cos(x(4)))^2*cos(x(5))*x(10)*(Iyy - Izz)) + cos(x(4))*(cos(x(5)))^2*sin(x(4))*x(10)*x(12)*(Iyy - Izz))*(Iyy*Izz*(cos(x(4)))^4*(cos(x(5)))^2 ...
    + 2*Iyy*Izz*(cos(x(4)))^2*(cos(x(5)))^2*(sin(x(4)))^2 + Ixx*Iyy*(cos(x(4)))^2*(sin(x(5)))^2 + Iyy*Izz*(cos(x(5)))^2*(sin(x(4)))^4 ...
    + Ixx*Izz*(sin(x(4)))^2*(sin(x(5)))^2))/(Ixx*Iyy*Izz*(cos(x(4)))^4*(cos(x(5)))^2 + 2*Ixx*Iyy*Izz*(cos(x(4)))^2*(cos(x(5)))^2*(sin(x(4)))^2 ...
    + Ixx*Iyy*Izz*(cos(x(5)))^2*(sin(x(4)))^4) + sin(x(5))*(Iyy*(cos(x(4)))^2 + Izz*(sin(x(4)))^2)*(TauPsi + x(11)*((Iyy - Izz)*(cos(x(5))*x(10)*(sin(x(4)))^2 ...
    + cos(x(4))*sin(x(5))*x(11)*sin(x(4))) - (cos(x(4)))^2*cos(x(5))*x(10)*(Iyy-Izz)-Ixx*cos(x(5))*sin(x(5))*x(10)...
    +Izz*(cos(x(4)))^2*cos(x(5))*sin(x(5))*x(10)+Iyy*cos(x(5))*(sin(x(4)))^2*sin(x(5))*x(10))- x(12)*(- Izz*sin(x(5))*x(11)*(cos(x(4)))^2*cos(x(5)) ...
    + x(10)*(Iyy - Izz)*cos(x(4))*(cos(x(5)))^2*sin(x(4)) - Iyy*sin(x(5))*x(11)*cos(x(5))*(sin(x(4)))^2 + Ixx*sin(x(5))*x(11)*cos(x(5)) ...
    + x(10)*(- cos(x(4))*sin(x(4))*x(10)*(Iyy - Izz)*(cos(x(5)))^2 + Ixx*x(11)*cos(x(5))))/(Iyy*Izz*(cos(x(4)))^4*(cos(x(5)))^2 ...
    + 2*Iyy*Izz*(cos(x(4)))^2*(cos(x(5)))^2*(sin(x(4)))^2+Iyy*Izz*(cos(x(5)))^2*(sin(x(4)))^4) ...
    - (cos(x(4))*sin(x(4))*sin(x(5))*(Iyy - Izz)*(TauTheta - x(10)*(Ixx*cos(x(5))*x(10) - (Iyy - Izz)*(cos(x(4))*sin(x(4))*x(11) ...
    + cos(x(5))*sin(x(4))*x(12)) + (cos(x(4)))^2*cos(x(5))*x(10)*(Iyy - Izz)) - x(12)*(Izz*cos(x(5))*sin(x(5))*x(10)*(cos(x(4)))^2 ...
    + Iyy*cos(x(5))*sin(x(5))*x(10)*(sin(x(4)))^2 - Ixx*cos(x(5))*sin(x(5))*x(10))+ cos(x(4))*sin(x(4))*x(10)*x(11)*(Iyy - Izz)))/(Iyy*Izz*cos(x(5))*(cos(x(4)))^4 ...
    + 2*Iyy*Izz*cos(x(5))*(cos(x(4)))^2*(sin(x(4)))^2 + Iyy*Izz*cos(x(5))*(sin(x(4)))^4)));
dxdt(11,1) = ((Izz*(cos(x(4)))^2 + Iyy*(sin(x(4)))^2)*(TauTheta - x(10)*(Ixx*cos(x(5))*x(10) - (Iyy - Izz)*(cos(x(4))*sin(x(4))*x(11) ...
    + cos(x(5))*sin(x(4))*x(12)) + (cos(x(4)))^2*cos(x(5))*x(10)*(Iyy-Izz)) - x(12)*(Izz*cos(x(5))*sin(x(5))*x(10)*(cos(x(4)))^2 ...
    + Iyy*cos(x(5))*sin(x(5))*x(10)*(sin(x(4)))^2 - Ixx*cos(x(5))*sin(x(5))*x(10)) + cos(x(4))*sin(x(4))*x(10)*x(11)*(Iyy - Izz)))/(Iyy*Izz*(cos(x(4)))^4 ...
    + 2*Iyy*Izz*cos((x(4)))^2*(sin(x(4)))^2 + Iyy*Izz*(sin(x(4)))^4) - (cos(x(4))*sin(x(4))*(Iyy - Izz)*(TauPsi + x(11)*((Iyy - Izz)*(cos(x(5))*x(10)*(sin(x(4)))^2 ...
    + cos(x(4))*sin(x(5))*x(11)*sin(x(4)) - (cos(x(4)))^2*cos(x(5))*x(10)*(Iyy - Izz) - Ixx*cos(x(5))*sin(x(5))*x(10) + Izz*(cos(x(4)))^2*cos(x(5))*sin(x(5))*x(10) ...
    + Iyy*cos(x(5))*(sin(x(4)))^2*sin(x(5))*x(10)) - x(12)*(- Izz*sin(x(5))*x(11)*(cos(x(4)))^2*cos(x(5)) + x(10)*(Iyy - Izz)*cos(x(4))*(cos(x(5)))^2*sin(x(4)) ...
    - Iyy*sin(x(5))*x(11)*cos(x(5))*(sin(x(4)))^2 + Ixx*sin(x(5))*x(11)*cos(x(5)) + x(10)*(- cos(x(4))*sin(x(4))*x(10)*(Iyy - Izz)*(cos(x(5)))^2 ...
    + Ixx*x(11)*cos(x(5))))/(Iyy*Izz*cos(x(5))*(cos(x(4)))^4 + 2*Iyy*Izz*cos(x(5))*(cos(x(4)))^2*(sin(x(4)))^2 + Iyy*Izz*cos(x(5))*(sin(x(4)))^4) ...
    - (cos(x(4))*sin(x(4))*sin(x(5))*(Iyy - Izz)*(TauPhi + x(11)*(Ixx*cos(x(5))*x(10) - (cos(x(5))*x(10)*(sin(x(4)))^2 + cos(x(4))*x(11)*sin(x(4)))*(Iyy - Izz)...
    + (cos(x(4)))^2*cos(x(5))*x(10)*(Iyy - Izz)) + cos(x(4))*(cos(x(5)))^2*sin(x(4))*x(10)*x(12)*(Iyy - Izz)))/(Iyy*Izz*cos(x(5))*(cos(x(4)))^4 ...
    + 2*Iyy*Izz*cos(x(5))*(cos(x(4)))^2*(sin(x(4)))^2 + Iyy*Izz*cos(x(5))*(sin(x(4)))^4))));
dxdt(12,1) = ((Iyy*(cos(x(4)))^2 + Izz*(sin(x(4)))^2)*(TauPsi + x(11)*((Iyy - Izz)*(cos(x(5))*x(10)*(sin(x(4)))^2 + cos(x(4))*sin(x(5))*x(11)*sin(x(4))) ...
    - (cos(x(4)))^2*cos(x(5))*x(10)*(Iyy - Izz) - Ixx*cos(x(5))*sin(x(5))*x(10) + Izz*cos(x(4))^2*cos(x(5))*sin(x(5))*x(10) ...
    + Iyy*cos(x(5))*(sin(x(4)))^2*sin(x(5))*x(10)) - x(12)*(- Izz*sin(x(5))*x(11)*(cos(x(4)))^2*cos(x(5)) + x(10)*(Iyy - Izz)*cos(x(4))*(cos(x(5)))^2*sin(x(4))...
    - Iyy*sin(x(5))*x(11)*cos(x(5))*(sin(x(4)))^2 + Ixx*sin(x(5))*x(11)*cos(x(5)) + x(10)*(- cos(x(4))*sin(x(4))*x(10)*(Iyy - Izz)*(cos(x(5)))^2 ...
    + Ixx*x(11)*cos(x(5)))))/(Iyy*Izz*(cos(x(4)))^4*(cos(x(5)))^2 + 2*Iyy*Izz*cos(x(4)))^2*(cos(x(5)))^2*(sin(x(4)))^2 + Iyy*Izz*(cos(x(5)))^2*(sin(x(4)))^4) ...
    + (sin(x(5))*(Iyy*(cos(x(4)))^2 + Izz*(sin(x(4)))^2)*(TauPhi + x(11)*(Ixx*cos(x(5))*x(10) - (cos(x(5))*x(10)*(sin(x(4)))^2 ...
    + cos(x(4))*x(11)*sin(x(4))*(Iyy - Izz) + (cos(x(4)))^2*cos(x(5))*x(10)*(Iyy - Izz)) ...
    + cos(x(4))*(cos(x(5)))^2*sin(x(4))*x(10)*x(12)*(Iyy - Izz)))/(Iyy*Izz*(cos(x(4)))^4*(cos(x(5)))^2 ...
    + 2*Iyy*Izz*(cos(x(4)))^2*(cos(x(5)))^2*(sin(x(4)))^2 + Iyy*Izz*(cos(x(5)))^2*(sin(x(4)))^4) ...
    - (cos(x(4))*sin(x(4))*(Iyy - Izz)*(TauTheta - x(10)*(Ixx*cos(x(5))*x(10) - (Iyy - Izz)*(cos(x(4))*sin(x(4))*x(11)...
    + cos(x(5))*sin(x(4))*x(12)) + (cos(x(4)))^2*cos(x(5))*x(10)*(Iyy - Izz)) - x(12)*(Izz*cos(x(5))*sin(x(5))*x(10)*(cos(x(4)))^2 ...
    + Iyy*cos(x(5))*sin(x(5))*x(10)*(sin(x(4)))^2 - Ixx*cos(x(5))*sin(x(5))*x(10)) ...
    + cos(x(4))*sin(x(4))*x(10)*x(11)*(Iyy - Izz)))/(Iyy*Izz*cos(x(5))*(cos(x(4)))^4 + 2*Iyy*Izz*cos(x(5))*(cos(x(4)))^2*(sin(x(4)))^2 ...
    + Iyy*Izz*cos(x(5))*(sin(x(4)))^4));
%
